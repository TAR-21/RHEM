## 💥 409 Conflictエラーの原因と対処法（`resourceVersion`の不一致）

### 🚨 エラーの原因

`409 Conflict`エラーは、**更新しようとしているYAMLファイル内の** `resourceVersion` の値が、**サーバー側のリソースの** `resourceVersion` と**一致しない**ために発生します。

* **デバイスリソースの特性:** デバイスの**タイムスタンプが更新**されると、サーバー側の `resourceVersion` が自動的に増えます。このとき、ローカルのYAMLファイルが古い値のままだと、不一致となりエラーが発生します。

---

### 🛠️ 現行バージョンでの2つの回避策

エラーを回避し、リソースを正しく更新するための方法は以下の2つです。

1.  **最新リソースを取得して再適用する**
    * `flightctl get device <id> > dev.yaml` で**サーバーの最新状態（正しい `resourceVersion`）**を取得します。
    * 取得した `dev.yaml` を編集します。
    * 編集後、リソースを適用（apply）します。

2.  **YAMLから `resourceVersion` を削除してから適用する**
    * YAMLファイルから `resourceVersion` の行を**完全に削除**します。
    * **⚠️ 注意点:** この方法は、「`resourceVersion` 以外に重要な変更がない」ことを**確実に確認できる場合**にのみ使用してください。

---

### ✨ 新しいバージョンでの改善点

新しいバージョンのシステムでは、このエラーが発生しにくく、また対処しやすくなっています。

1.  **タイムスタンプ更新による `resourceVersion` のインクリメントが廃止**
    * 単なるタイムスタンプの更新では `resourceVersion` が上がらなくなったため、**`409 Conflict`エラーの発生自体が減少**します。
2.  **`flightctl edit` コマンドの導入**
    * このコマンドは、リソース全体を置き換える `PUT` ではなく、部分更新の **`PATCH` メソッド**を使用します。
    * `PATCH` メソッドは `resourceVersion` の不一致に対してより耐性があり、**競合（コンフリクト）を適切に処理**してくれます。
